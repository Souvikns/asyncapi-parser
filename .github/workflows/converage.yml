name: coverage

on:
    pull_request: 
        types: [opened, synchronize, reopened, ready_for_review]
jobs:
  test:
    name: coverage
    runs-on: ubuntu-latest
    steps:
        # Checkout Repository
        - name: Checkout Repository
          uses: actions/checkout@v3
        # Setup up Rust toolchain
        - name: Set up Rust
          uses: actions-rs/toolchain@v1
          with:
            toolchain: stable
            override: true
        - name: Install dependencies
          run: cargo fetch 
        - name: Install tarpaulin
          run: cargo install cargo-tarpaulin
        - name: Generate coverage
          run: |
            cargo tarpaulin --verbos --all-features --workspace --timeout 120 --out xml
        - name: upload to codecov.io
          uses: codecov/codecov-action@v2
          with:
            fail_ci_if_error: true